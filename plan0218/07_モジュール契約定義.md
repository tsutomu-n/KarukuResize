# 07: モジュール契約定義

## 目的
- UI分割後の再肥大化を防ぐため、各モジュールの入出力と依存方向を固定する。

## 契約原則
1. `gui_app.py` はオーケストレーター専任。  
2. UIモジュール間の直接参照は禁止。必ず `gui_app.py` 経由で連携。  
3. UIモジュールは `build_*()` と `apply_*()` を公開APIの基本とする。  
4. UI更新は「状態入力 -> 描画反映」の一方向にする。  
5. 設定保存キー名は既存互換を維持する（`ui_mode` など）。

## 対象モジュール（最小）
1. `ui_topbar.py`
2. `ui_settings_dialog.py`
3. `ui_file_list_panel.py`
4. `ui_preview_panel.py`
5. `ui_metadata_panel.py`
6. `ui_statusbar.py`
7. `ui_detail_controls.py`
8. `ui_theme_tokens.py`
9. `ui_text_presenter.py`
10. `ui_display_policy.py`

## API契約テンプレート
```python
@dataclass
class XxxState:
    ...

@dataclass
class XxxCallbacks:
    ...

@dataclass
class XxxRefs:
    ...

def build_xxx(parent, state: XxxState, callbacks: XxxCallbacks) -> XxxRefs: ...
def apply_xxx_state(refs: XxxRefs, state: XxxState) -> None: ...
```

## 禁止事項
1. UIモジュール内部で `settings_store` へ直接保存しない。  
2. UIモジュール内部で他UIモジュールのWidgetへ直接アクセスしない。  
3. トークン外の色/余白のハードコードを追加しない。  
4. 表示モード判定を各モジュールに重複実装しない。

## 完了条件
1. 各UIモジュールに公開API契約が明示されている。  
2. 依存方向が `gui_app.py -> 各UIモジュール` の放射構造で保たれている。  
3. 変更時に横断修正が必要なケースが減っている。

