# 実装計画（Phase設計）

## 0. 実装方針
- 要件過多による失敗を避けるため、段階導入で進める。
- まずGUIのみで要件を完結させる。
- 各Phaseごとに「動く状態」を維持する。

## 1. 変更対象ファイル（想定）
1. `src/karuku_resizer/gui_app.py`
   - UI要素追加
   - 保存処理拡張
   - ドライラン/ログ/EXIFモード導入
2. `karuku_settings.json` 互換ロジック
   - 追加設定の保存・復元
3. `README.md` / `docs/QUICK_START.md`
   - 実装済み機能へ記述整合
4. `tests/*`（必要最小限）
   - ロジックテスト追加（可能な範囲）

## 2. Phase 1（高価値・低リスク）

### 2.1 目的
「使える」状態を最短で作る。

### 2.2 スコープ
1. 品質設定（5〜100, 5刻み）
2. 出力形式選択（JPEG/PNG/WEBP/AVIF）
3. ドライラン
4. 詳細ログ切替
5. EXIFモード: `keep/remove`
6. GPS削除オプション
7. 保存後結果表示（EXIF反映/未反映）

### 2.3 実装タスク
1. UI拡張
   - 出力設定セクション追加
   - EXIF設定セクション追加
2. 設定永続化
   - 新規キーの保存/復元
3. 画像保存共通関数の導入
   - 単体保存と一括保存の重複削減
4. フォーマット別保存分岐
   - JPEG/PNG/WebP/AVIF
5. EXIF処理ユーティリティ
   - keep/remove
   - GPS除去
6. ドライラン分岐
   - ファイル保存スキップ
   - 予定結果の表示
7. 詳細ログ切替
   - INFO/DEBUG相当の切替

### 2.4 受け入れ条件
1. GUI上で品質が5刻みで選べる
2. 0や不正値が保存経路に入らない
3. 出力形式が選択でき、未対応形式は無効化される
4. EXIF keep/removeが機能し、GPS削除も反映される
5. ドライランでファイルを作らない
6. 単体保存・一括保存の両方で同挙動

## 3. Phase 2（編集機能追加）

### 3.1 目的
EXIFの実用編集を安全に提供する。

### 3.2 スコープ
1. EXIFモード `edit`
2. 編集項目限定
   - Artist
   - Copyright
   - UserComment
   - DateTimeOriginal
3. 保存前差分プレビュー

### 3.3 実装タスク
1. edit時フォームUI
2. EXIF編集ロジック
3. 差分表示ロジック
4. 未適用タグの警告表示

### 3.4 受け入れ条件
1. edit項目が保存結果に反映される
2. 対応外フォーマット/タグでクラッシュしない
3. 差分表示がユーザーに理解可能

## 4. Phase 3（任意）

### 4.1 目的
必要性が確認できたときのみ高度化。

### 4.2 候補
1. 任意タグ編集
2. 高度なメタデータ制御
3. プリセットの入出力

## 5. リスクと対策
1. フォーマット依存挙動
   - 対策: 実行時feature判定、フォールバック表示
2. EXIF編集の互換性
   - 対策: 項目限定、失敗時スキップ継続
3. GUI肥大化
   - 対策: セクション分割、advanced表示切替
4. 既存コードの重複
   - 対策: 保存ロジックを共通関数化

## 6. 完了定義
1. Phase 1の受け入れ条件を満たす
2. ドキュメントが実装と一致
3. 最低限の動作確認手順がドキュメント化される

