# セッション調査結果：リポジトリ実態

## 1. 調査範囲
今回のセッションで確認した対象：
- ルート構成（`README.md`, `docs/*`, `src/*`, `tests/*`）
- 実行エントリポイント（`pyproject.toml`）
- GUI実装（`src/karuku_resizer/gui_app.py`）
- CLI実装（`src/karuku_resizer/resize_core.py`）
- 補助設計資料（`design.md`, `tasks.md`, `docs/*`）
- 実行可否の確認（`python -m ... --help`）

## 2. リポジトリの高レベル像
- プロジェクト名: `karuku-resizer`
- バージョン: `0.2.1`
- 主要モジュール:
  - `src/karuku_resizer/gui_app.py`（GUI）
  - `src/karuku_resizer/resize_core.py`（CLI・コア）
- エントリポイント:
  - `karukuresize-gui = karuku_resizer.gui_app:main`
  - `karukuresize-cli = karuku_resizer.resize_core:main`

## 3. ドキュメント記載機能と実装実態の差分

### 3.1 README / QUICK_START の主張
`README.md` と `docs/QUICK_START.md` では以下が前提として記載されている。
- GUI/CLIの双方が利用可能
- GUIで豊富な処理モード・形式・設定が可能
- CLIで一括処理が利用可能

### 3.2 実装の実態（今回確認）
- GUI側コードは存在し、単体機能として成立している設計。
- CLI側コードは構文エラーを含み、起動前に失敗する。
- API/開発者ドキュメントには旧モジュール名・旧構成記載が混在し、現行コードとの差異がある。

## 4. GUI実装の実態（`src/karuku_resizer/gui_app.py`）

### 4.1 実装されている主要機能
1. 画像ファイル複数選択
2. サイズ指定モード切替
   - 比率 `%`
   - 幅 `px`
   - 高さ `px`
   - 固定 `幅×高さ`
3. プレビュー表示（オリジナル/リサイズ後）
4. 単体保存
5. 一括保存（進捗バー・キャンセル）
6. ズーム操作
7. 設定保存・復元（`karuku_settings.json`）

### 4.2 現時点で未実装（重要）
- ユーザー指定の品質パラメータUI
- ユーザー指定の出力形式UI（JPEG/PNG/WebP/AVIFの明示切替）
- ドライランUI
- 詳細ログレベル切替UI
- EXIFモード（keep/edit/remove）UI

### 4.3 保存処理の実装特性
- 保存時は `quality=95`, `optimize=True` の固定指定がある。
- 出力形式はユーザー選択ではなく、内部判断（例: アルファ有無）ベース。

## 5. CLI実装の実態（`src/karuku_resizer/resize_core.py`）

### 5.1 観測された問題
1. ファイル中に `{{ ... }}` プレースホルダ文字列が残っている。
2. そのためソースが壊れており、`python -m karuku_resizer.resize_core --help` が構文エラーで失敗。
3. `main()` 内で呼ぶ関数名（`find_image_files` など）と、実際にファイル中で確認できる定義の対応が崩れている。

### 5.2 影響
- 現状、CLI経路はエンドユーザーが利用できない。
- パッケージのCLIエントリポイントは定義されているが、実行時に失敗する。

## 6. テスト群の実態
- `tests/test_basic.py` は最小の疎通テストのみ。
- `tests/legacy/*` は存在するが、現行モジュール構成との差分が大きいものが含まれる。
- `tests/legacy/test_resize_core.py` は旧関数群への依存が見られ、現状コードとの差異がある可能性が高い。

## 7. 設計資料の整合性

### 7.1 `design.md` / `tasks.md`
- GUIモダナイズや設定保持の実装計画が記載されている。
- 現在の `gui_app.py` と方向性は整合するが、未完了タスクを前提にしている箇所がある。

### 7.2 `docs/developer_guide.md` / `docs/api_reference.md`
- 一部に旧ファイル名・旧アーキテクチャ記述（`resize_images.py` など）が残る。
- 現行コードとの差異があり、参照時に注意が必要。

## 8. このセッションで確定できたこと（断定可能事項）
1. 現時点で CLI は実行できない（構文エラー）。
2. GUIはコード上で主要なリサイズ機能を持つが、要求された新機能（品質/形式/ドライラン/詳細ログ/EXIF編集）は未搭載。
3. README等の説明は、現行実装と完全一致していない。

## 9. このセッションで未確認の事項
1. GUIの実行時挙動（実環境）
   - セッション環境では `customtkinter` 未導入のため起動確認不可。
2. `resize_core.py` の意図された最終完成版
   - 現在は破損状態で、仕様の完全性は未確認。

## 10. 実装前提としての示唆
- 新機能追加に着手する前に、少なくともGUI経路で完結する設計に絞ると進行しやすい。
- CLI修復は別トラックで扱うほうが安全（要件混線を防ぐため）。

