# 実装進捗ログ（開始）

## 実施日時
- 2026-02-10 11:xx

## 実施内容（Phase 1着手）
1. 画像保存処理をGUI本体から分離し、`src/karuku_resizer/image_save_pipeline.py` を新規追加。
2. `src/karuku_resizer/gui_app.py` に保存設定UIを追加。
   - 出力形式（自動/JPEG/PNG/WEBP/AVIF）
   - 品質（5〜100、5刻み）
   - EXIF（保持/削除）
   - GPS削除
   - ドライラン
   - 詳細ログ
3. 単体保存・一括保存を新パイプラインへ接続。
4. 設定永続化キーを追加し、復元処理を更新。

## 技術的な修正ポイント
1. 品質値は `normalize_quality()` で 5刻み正規化。
2. 形式判定は `resolve_output_format()` で実画像ベースに決定。
3. WebP/AVIF可否は `features.check()` + `Image.registered_extensions()` で判定。
4. EXIFは keep/remove + GPS削除を実装（editは未着手）。

## 検証
1. `python -m py_compile src/karuku_resizer/image_save_pipeline.py src/karuku_resizer/gui_app.py`
2. 構文エラーなしを確認。

## 未着手
1. 保存前EXIF差分プレビュー

## 追加改善（内省反映）
1. EXIF edit を実装（Artist/Copyright/UserComment/DateTimeOriginal）
2. EXIF付与失敗時のフォールバック保存を実装（メタデータなしで保存継続）
3. EXIFステータス表示を詳細化（フォールバック/未付与理由/編集項目数）
4. 読み込み時に `ImageOps.exif_transpose` を適用し、Orientation由来の不整合を抑制
5. 一括保存時の同名衝突回避（`_resized`, `_resized_1`, ...）
