# タスク分解と実装順序

## 1. 実装方針
- 変更範囲は `src/karuku_resizer/gui_app.py` 中心に限定。
- 1タスクごとに静的検証を通し、段階的に積む。

## 2. タスク分解

### T1: カラースキーム切替UI
- 目的: ユーザーが `System/Light/Dark` を選べるようにする。
- 変更:
  - 設定ヘッダに選択UIを追加
  - 変更イベントで `set_appearance_mode`
  - 既存プレビュー再描画を呼ぶ
- 対象ファイル:
  - `src/karuku_resizer/gui_app.py`

### T2: 設定保存復元
- 目的: 切替設定の永続化。
- 変更:
  - `SettingsManager._default_settings` に `appearance_mode` 追加
  - `_restore_settings` で復元
  - `_save_current_settings` で保存
- 対象ファイル:
  - `src/karuku_resizer/gui_app.py`

### T3: プロモード限定メタデータパネル（折りたたみ）
- 目的: 選択画像のメタデータ要点を確認可能にする。
- 変更:
  - `ImageJob` に表示用メタデータキャッシュを追加
  - メタデータ抽出ヘルパー追加
  - プロモード時のみ表示
- 対象ファイル:
  - `src/karuku_resizer/gui_app.py`

### T4: 表示更新の連動
- 目的: 選択画像変更・モード変更時の整合性維持。
- 変更:
  - `_on_select_change`, `_apply_ui_mode`, `_draw_previews` 周辺連動
- 対象ファイル:
  - `src/karuku_resizer/gui_app.py`

## 3. 検証手順
1. 構文
   - `python -m py_compile src/karuku_resizer/gui_app.py`
2. Lint
   - `uv run ruff check src/karuku_resizer/gui_app.py`
3. 既存保存機能回帰
   - `uv run pytest tests/test_image_save_pipeline.py -q`
4. 手動GUI
   - カラースキームを3モード切替し即時反映確認
   - 再起動後復元確認
   - プロモードでメタデータ折りたたみ表示確認

## 4. 完了条件
1. 仕様どおりの表示と保存復元が実現。
2. 静的チェック/既存テストが通過。
3. 既存機能の操作導線（選択->プレビュー->保存）が維持。
