# 05 実装計画と再開手順

## 分かったこと（詳細）
1. 直近で着手すべきは、UIモード分離と保存ロジック拡張の接続。
2. 既存コードへの影響を抑えるには、以下順序が安全:
   - GUI表示制御
   - 設定保存拡張
   - 保存オプション拡張
   - テスト追加

## 技術要素
1. 主要編集対象:
   - `src/karuku_resizer/gui_app.py`
   - `src/karuku_resizer/image_save_pipeline.py`
   - `tests/test_image_save_pipeline.py`
2. 補助確認:
   - `pyproject.toml`（依存/エントリ）
   - `src/karuku_resizer/build_exe.py`（Windows実機）

## 決定事項
1. 実装は段階導入（Phase方式）で進める。
2. 既存保存導線（単体/一括）を同時に壊さないことを優先する。

## 未解決点
1. プロモードの最初の入力項目セット最終確定。
2. GUI不具合報告（詳細設定表示不具合）の再現条件固定。

## 検証方法
1. フェーズごとに回帰確認:
   - プレビュー
   - 単体保存
   - 一括保存
   - 再起動復元
2. テスト追加後:
   - `pytest tests/test_image_save_pipeline.py -q`

## 再開手順（30秒版）
1. まず `src/karuku_resizer/gui_app.py` で `ui_mode` 追加位置を決める。
2. `_setup_output_controls` と `_setup_settings_layers` にモード別表示ロジックを入れる。
3. `_save_current_settings` / `_restore_settings` に `ui_mode` を追加する。
4. `image_save_pipeline.py` は既存4項目を壊さず、項目追加分を段階的に実装する。
5. テストを追加して実行する。

## 関連ファイル/URL
1. `src/karuku_resizer/gui_app.py`
2. `src/karuku_resizer/image_save_pipeline.py`
3. `tests/test_image_save_pipeline.py`
4. `.ai_memory/計画: 2月10日16時49分/06_実装計画_簡易モード_プロモード.md`
