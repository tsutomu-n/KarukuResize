# 04 メタデータ機能設計

## 分かったこと（詳細）
1. ユーザー方針は「事務員向け簡易操作 + プロ向け詳細編集」の両立。
2. 現行基盤が既にあるため、全面刷新ではなく段階拡張が最も安全。
3. 実装優先は以下:
   - 簡易モードで必要最低限
   - プロモードで詳細編集

## 技術要素
1. EXIFモード:
   - keep
   - edit
   - remove
2. 追加候補項目:
   - 第1段階: タイトル、コメント、キーワード、GPS詳細
   - 第2段階: Camera/Lens、ISO、露出、絞り、焦点距離
3. バリデーション:
   - 日時形式 `YYYY:MM:DD HH:MM:SS`
   - 品質 5〜100（5刻み）
   - GPSの入力形式（DMSまたは十進度）は仕様確定が必要

## 決定事項
1. 簡易モードを初期値とする。
2. プロモードで詳細編集項目を開放する。
3. 既存のEXIFフォールバック保存仕様は維持する。

## 未解決点
1. GPS入力UIの仕様（自由入力/補助入力）。
2. プロモードでの項目表示方式（単一画面/ダイアログ）。
3. 項目追加時の `ExifEditValues` 命名規則。

## 検証方法
1. EXIF差分表示で「保持/変更/削除」を判別できるか確認。
2. 保存後に `Image.getexif()` で値を再読取して一致確認。
3. 失敗時フォールバックがユーザーに明示されるか確認。

## 関連ファイル/URL
1. `src/karuku_resizer/gui_app.py`
2. `src/karuku_resizer/image_save_pipeline.py`
3. https://learn.microsoft.com/ja-jp/windows/win32/wic/-wic-native-image-format-metadata-queries
4. https://github.com/python-pillow/pillow/blob/main/docs/handbook/image-file-formats.rst
