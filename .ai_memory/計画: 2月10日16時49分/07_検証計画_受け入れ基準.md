# 検証計画と受け入れ基準

## 1. 検証方針
- 実装は段階導入し、各段階で回帰確認を行う。
- GUI挙動と保存結果の両方を確認する。
- 単体保存と一括保存を同等に扱う。

## 2. テスト分類

### 2.1 単体テスト（自動）
対象:
- `tests/test_image_save_pipeline.py`

追加検証観点:
1. 品質値の正規化:
   - 入力が 5刻みに丸まるか
   - 下限/上限が守られるか
2. EXIF編集:
   - 追加項目が期待タグへ反映されるか
   - 空値や不正値の扱いが想定通りか
3. EXIFモード:
   - keep/remove/edit の分岐が正しいか
4. フォールバック:
   - EXIF保存失敗時にメタデータなし保存へ移行できるか
5. dry-run:
   - 実ファイルを生成しないか

### 2.2 GUI手動テスト
対象:
- `src/karuku_resizer/gui_app.py`

観点:
1. 簡易モード初期表示
2. プロモード切替
3. 項目の有効/無効状態
4. 設定保存・再起動復元
5. 単体保存結果
6. 一括保存結果
7. EXIF差分表示内容
8. エラーダイアログ表示

### 2.3 実機検証（Windows）
対象:
- `karukuresize-build-exe` で生成した `KarukuResize.exe`

観点:
1. 起動可否
2. 詳細設定表示
3. 保存操作
4. モード切替
5. メタデータ関連操作

## 3. テストケース一覧（抜粋）

1. Case-GUI-01
   - 条件: 起動直後
   - 期待: 簡易モードが表示される

2. Case-GUI-02
   - 条件: プロモード切替
   - 期待: 詳細項目が表示され、簡易項目の値は保持される

3. Case-SAVE-01
   - 条件: EXIF keep + JPEG保存
   - 期待: 元EXIFが付与される

4. Case-SAVE-02
   - 条件: EXIF remove
   - 期待: EXIFが付与されない

5. Case-SAVE-03
   - 条件: EXIF edit + 編集値あり
   - 期待: 編集項目が保存結果に反映される

6. Case-SAVE-04
   - 条件: dry-run
   - 期待: 出力ファイル未生成、結果メッセージは成功

7. Case-BATCH-01
   - 条件: 一括保存 + EXIF edit
   - 期待: 全対象で設定が一貫して適用される

8. Case-CONFIG-01
   - 条件: アプリ再起動
   - 期待: モード、品質、形式、EXIF関連設定が復元される

## 4. 受け入れ基準
1. 主要ケース（上記1〜8）が再現可能で、致命エラーがない。
2. 保存時の結果表示が実際の処理結果と一致する。
3. 既存テストが失敗しない。
4. 新規追加テストが通る。
5. `.exe` で主要導線が再現できる。

## 5. 不具合発生時の対応記録フォーマット
1. 発生条件
2. 実際結果
3. 期待結果
4. ログ要約
5. 修正対象ファイル
6. 回帰確認結果

## 6. 完了時に残す成果物
1. テスト結果ログ
2. 修正パッチ
3. 更新済み計画書（必要時）
